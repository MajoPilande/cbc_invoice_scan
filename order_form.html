<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>POS Order + Scanner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
    }
    #scanner-section {
      margin-top: 30px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h2>POS Order + Scanner</h2>

  <form id="orderForm">
    <input type="text" id="customerName" placeholder="Customer Name" required />
    <input type="text" id="customerAddress" placeholder="Customer Address" required />
    <input type="text" id="customerContact" placeholder="Customer Contact Number" required />

    <select id="minerType" required>
      <option value="">Select Miner Type</option>
      <option value="Old Miner">Old Miner</option>
      <option value="New Miner">New Miner</option>
    </select>

    <input type="date" id="orderDate" required />
    <input type="number" id="numItems" placeholder="Number of Items" readonly />
    <input type="number" id="totalOrder" placeholder="Total Order Amount" readonly />

    <select id="shippingStatus" required>
      <option value="">Select Shipping Status</option>
      <option value="To Ship">To Ship</option>
      <option value="Shipped">Shipped</option>
      <option value="Picked Up">Picked Up</option>
    </select>

    <select id="paymentStatus" required>
      <option value="">Select Payment Status</option>
      <option value="Paid">Paid</option>
      <option value="With Balance">With Balance</option>
      <option value="Unpaid">Unpaid</option>
    </select>

    <select id="shippingFeeStatus" required>
      <option value="">Select Shipping Fee Status</option>
      <option value="Paid">Paid</option>
      <option value="Unpaid">Unpaid</option>
    </select>

    <button type="submit">Save Order</button>
  </form>

  <div id="scanner-section">
    <h3>Scan Items</h3>
    <div id="reader" width="100%"></div>
    <ul id="item-list"></ul>
    <p><strong>Total: ₱<span id="total">0</span></strong></p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyA8hwnrtDAjTQRBaLA-xoEGkBAMoqqqgs8",
        authDomain: "cbcpos-fc5fd.firebaseapp.com",
        projectId: "cbcpos-fc5fd",
        storageBucket: "cbcpos-fc5fd.firebasestorage.app",
        messagingSenderId: "298186051078",
        appId: "1:298186051078:web:d311d3f5c8cad50e54bd87",
        measurementId: "G-SVB5LQ9WF8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Set date
    document.getElementById("orderDate").valueAsDate = new Date();

    // Scanner logic
    let total = 0;
    let items = [];
    let lastScanTime = 0;
    const list = document.getElementById("item-list");

    const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YYAAAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA=");

    const scanner = new Html5Qrcode("reader");
    scanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      (qrCodeMessage) => {
        const now = Date.now();
        if (now - lastScanTime < 1500) return;
        lastScanTime = now;

        if (qrCodeMessage.startsWith("P")) {
          const amount = parseInt(qrCodeMessage.replace("P", ""));
          if (!isNaN(amount)) {
            items.push(amount);
            total += amount;
            document.getElementById("total").innerText = total;
            document.getElementById("numItems").value = items.length;
            document.getElementById("totalOrder").value = total;

            const li = document.createElement("li");
            li.innerText = `₱${amount}`;
            list.appendChild(li);

            beep.play();
          }
        }
      },
      () => {}
    );

    // Save to Firebase
    document.getElementById("orderForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const orderData = {
        customerName: document.getElementById("customerName").value,
        customerAddress: document.getElementById("customerAddress").value,
        customerContact: document.getElementById("customerContact").value,
        minerType: document.getElementById("minerType").value,
        orderDate: document.getElementById("orderDate").value,
        numItems: parseInt(document.getElementById("numItems").value),
        totalOrder: parseFloat(document.getElementById("totalOrder").value),
        shippingStatus: document.getElementById("shippingStatus").value,
        paymentStatus: document.getElementById("paymentStatus").value,
        shippingFeeStatus: document.getElementById("shippingFeeStatus").value,
        scannedItems: items
      };

      db.ref("orders").push(orderData).then(() => {
        alert("Order saved!");
        document.getElementById("orderForm").reset();
        document.getElementById("item-list").innerHTML = "";
        document.getElementById("total").innerText = "0";
        total = 0;
        items = [];
        document.getElementById("orderDate").valueAsDate = new Date();
      });
    });
  </script>
</body>
</html>
